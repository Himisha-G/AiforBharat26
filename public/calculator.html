<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Customer Billing</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="home-body">

  <!-- üåç Language Selector -->
  <div class="lang-bar">
    üåç Language:
    <select id="langSelect" onchange="setLanguage()">
      <option value="en">English</option>
      <option value="hi">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
      <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
    </select>
  </div>

  <!-- Billing Container -->
  <div class="billing-container">

    <!-- Header -->
    <h1 class="billing-title" id="pageTitle">üßæ Smart Customer Billing</h1>
    <p class="billing-subtitle" id="pageSubtitle">
      Add multiple items for one customer and generate total bill instantly
    </p>

    <!-- Billing Card -->
    <div class="billing-card">

      <!-- Input Row -->
      <div class="billing-inputs">

        <!-- Commodity Dropdown -->
        <div class="field">
          <label id="itemLabel">üõí Select Item</label>
          <select id="item">
            <option>Loading live mandi items...</option>
          </select>
        </div>

        <!-- Quantity -->
        <div class="field">
          <label id="qtyLabel">‚öñ Quantity (kg)</label>
          <input id="qty" type="number" placeholder="Enter kg" />
        </div>

        <!-- Add Button -->
        <div class="field">
          <button class="add-btn" onclick="addItem()" id="addBtn">
            ‚ûï Add Item
          </button>
        </div>

      </div>

      <!-- Bill Section -->
      <h2 class="bill-heading" id="billHeading">üìã Current Customer Bill</h2>

      <div class="bill-box">
        <ul id="billList"></ul>
      </div>

      <!-- Total -->
      <div class="total-box">
        <h2 id="totalBill">Total: ‚Çπ0</h2>
      </div>

      <!-- Print Button -->
      <button class="print-btn" onclick="window.print()" id="printBtn">
        üñ® Print Invoice
      </button>

      <!-- Buttons -->
      <div class="billing-actions">
        <button class="new-btn" onclick="newCustomer()" id="newBtn">
          üÜï New Customer
        </button>

        <a href="index.html" class="back-btn" id="backBtn">
          ‚¨Ö Back Home
        </a>
      </div>

    </div>
  </div>

  <!-- ==============================
        SCRIPT (LIVE + MULTILINGUAL)
  ============================== -->
  <script>
    let total = 0;
    let currentPrices = {};

    /* ===============================
       üåç TRANSLATION DICTIONARY
    =============================== */
    const translations = {
      en: {
        title: "üßæ Smart Customer Billing",
        subtitle: "Add multiple items for one customer and generate total bill instantly",
        selectItem: "üõí Select Item",
        quantity: "‚öñ Quantity (kg)",
        add: "‚ûï Add Item",
        bill: "üìã Current Customer Bill",
        print: "üñ® Print Invoice",
        newCustomer: "üÜï New Customer",
        back: "‚¨Ö Back Home"
      },
      hi: {
        title: "üßæ ‡§∏‡•ç‡§Æ‡§æ‡§∞‡•ç‡§ü ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó",
        subtitle: "‡§è‡§ï ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡•á ‡§≤‡§ø‡§è ‡§ï‡§à ‡§µ‡§∏‡•ç‡§§‡•Å‡§è‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç ‡§î‡§∞ ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§¨‡§ø‡§≤ ‡§¨‡§®‡§æ‡§è‡§Ç",
        selectItem: "üõí ‡§µ‡§∏‡•ç‡§§‡•Å ‡§ö‡•Å‡§®‡•á‡§Ç",
        quantity: "‚öñ ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ (‡§ï‡§ø‡§≤‡•ã)",
        add: "‚ûï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        bill: "üìã ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§¨‡§ø‡§≤",
        print: "üñ® ‡§¨‡§ø‡§≤ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç",
        newCustomer: "üÜï ‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï",
        back: "‚¨Ö ‡§µ‡§æ‡§™‡§∏ ‡§π‡•ã‡§Æ"
      },
      ta: {
        title: "üßæ ‡Æ∏‡Øç‡ÆÆ‡Ææ‡Æ∞‡Øç‡Æü‡Øç ‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç ‡Æ™‡Æø‡Æ≤‡Øç‡Æ≤‡Æø‡Æô‡Øç",
        subtitle: "‡Æí‡Æ∞‡Øá ‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ ‡Æ™‡Æ≤ ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æü‡Øç‡Æï‡Æ≥‡Øç ‡Æö‡Øá‡Æ∞‡Øç‡Æ§‡Øç‡Æ§‡ØÅ ‡Æâ‡Æü‡Æ©‡Øá ‡Æ™‡Æø‡Æ≤‡Øç ‡Æâ‡Æ∞‡ØÅ‡Æµ‡Ææ‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
        selectItem: "üõí ‡Æ™‡Øä‡Æ∞‡ØÅ‡Æ≥‡Øç ‡Æ§‡Øá‡Æ∞‡Øç‡Æµ‡ØÅ",
        quantity: "‚öñ ‡ÆÖ‡Æ≥‡Æµ‡ØÅ (‡Æï‡Æø‡Æ≤‡Øã)",
        add: "‚ûï ‡Æö‡Øá‡Æ∞‡Øç‡Æï‡Øç‡Æï‡Æµ‡ØÅ‡ÆÆ‡Øç",
        bill: "üìã ‡Æ§‡Æ±‡Øç‡Æ™‡Øã‡Æ§‡Øà‡ÆØ ‡Æ™‡Æø‡Æ≤‡Øç",
        print: "üñ® ‡Æ™‡Æø‡Æ≤‡Øç ‡ÆÖ‡Æö‡Øç‡Æö‡Æø‡Æü‡ØÅ",
        newCustomer: "üÜï ‡Æ™‡ØÅ‡Æ§‡Æø‡ÆØ ‡Æµ‡Ææ‡Æü‡Æø‡Æï‡Øç‡Æï‡Øà‡ÆØ‡Ææ‡Æ≥‡Æ∞‡Øç",
        back: "‚¨Ö ‡ÆÆ‡ØÅ‡Æï‡Æ™‡Øç‡Æ™‡ØÅ"
      }
    };

    /* ===============================
       üåç APPLY LANGUAGE
    =============================== */
    function setLanguage() {
      const lang = document.getElementById("langSelect").value;
      localStorage.setItem("appLang", lang);

      document.getElementById("pageTitle").innerText = translations[lang].title;
      document.getElementById("pageSubtitle").innerText = translations[lang].subtitle;
      document.getElementById("itemLabel").innerText = translations[lang].selectItem;
      document.getElementById("qtyLabel").innerText = translations[lang].quantity;
      document.getElementById("addBtn").innerText = translations[lang].add;
      document.getElementById("billHeading").innerText = translations[lang].bill;
      document.getElementById("printBtn").innerText = translations[lang].print;
      document.getElementById("newBtn").innerText = translations[lang].newCustomer;
      document.getElementById("backBtn").innerText = translations[lang].back;
    }

    function loadLanguage() {
      const saved = localStorage.getItem("appLang") || "en";
      document.getElementById("langSelect").value = saved;
      setLanguage();
    }

    /* ===============================
       ‚úÖ LOAD LIVE PRICES FROM SERVER
    =============================== */
    async function loadBillingItems() {
      const dropdown = document.getElementById("item");

      try {
        const res = await fetch("/billing-items");
        const data = await res.json();

        dropdown.innerHTML = "";

        data.forEach((item) => {
          currentPrices[item.name] = item.price;

          const opt = document.createElement("option");
          opt.value = item.name;
          opt.textContent = `${item.name} (‚Çπ${item.price}/quintal)`;

          dropdown.appendChild(opt);
        });

      } catch (err) {
        dropdown.innerHTML = "<option>Error loading prices</option>";
      }
    }

    /* ===============================
       ‚úÖ BILLING FUNCTION
    =============================== */
    function addItem() {
      let itemName = document.getElementById("item").value;
      let qty = parseFloat(document.getElementById("qty").value);

      if (!qty || qty <= 0) {
        alert("Enter valid quantity!");
        return;
      }

      let price = currentPrices[itemName];

      // Convert quintal ‚Üí kg
      let perKgPrice = price / 100;

      let cost = perKgPrice * qty;
      total += cost;

      let li = document.createElement("li");
      li.innerHTML = `
        <span>${itemName}</span>
        <span>${qty} kg</span>
        <span>‚Çπ${cost.toFixed(2)}</span>
      `;

      document.getElementById("billList").appendChild(li);

      document.getElementById("totalBill").innerText =
        "Total: ‚Çπ" + total.toFixed(2);

      document.getElementById("qty").value = "";
    }

    function newCustomer() {
      total = 0;
      document.getElementById("billList").innerHTML = "";
      document.getElementById("totalBill").innerText = "Total: ‚Çπ0";
      alert("‚úÖ New customer bill started!");
    }

    /* ===============================
       RUN ON PAGE LOAD
    =============================== */
    window.onload = () => {
      loadLanguage();
      loadBillingItems();
    };
  </script>

</body>
</html>
