<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Mandi Prices</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body class="home-body">

  <div class="panel center mandi-page">

    <!-- Header -->
    <h1 class="mandi-title">ğŸ“Š Live Mandi Market Prices</h1>
    <p class="mandi-subtitle">
      Government verified daily mandi prices for Indian vendors & farmers
    </p>

    <!-- Info Row -->
    <div class="info-row">
      <span class="badge">ğŸ‡®ğŸ‡³ Source: data.gov.in API</span>
      <span class="badge">ğŸ•’ Updated: <span id="time"></span></span>
    </div>

    <!-- Loading Text -->
    <h3 id="loadingText" style="margin-top:20px;">
      â³ Fetching live mandi prices...
    </h3>

    <!-- LIVE Price Cards -->
    <div id="priceGrid" class="price-grid"></div>

    <!-- AI Recommendation Box -->
    <div class="ai-box">
      <h2>ğŸ¤– AI Market Suggestion</h2>
      <p id="aiSuggestion">
        Loading AI insights...
      </p>
    </div>

    <!-- Navigation -->
    <a href="index.html" class="back-btn">â¬… Back Home</a>

  </div>

  <!-- Script -->
  <script>
    // Show current update time
    document.getElementById("time").innerText =
      new Date().toLocaleTimeString();

    /* -----------------------------
       âœ… Load LIVE Prices from Server
    ------------------------------ */
    async function loadLivePrices() {
      const grid = document.getElementById("priceGrid");
      const loading = document.getElementById("loadingText");

      try {
        // Fetch live mandi prices from backend route
        const res = await fetch("/live-prices");
        const data = await res.json();

        loading.style.display = "none";
        grid.innerHTML = "";

        if (!data || data.length === 0) {
          grid.innerHTML = "<p>No live price data available.</p>";
          return;
        }

        // Generate cards dynamically
        data.forEach((item) => {
          grid.innerHTML += `
            <div class="price-card">
              <h2>ğŸŒ¾ ${item.commodity}</h2>
              <p class="price">
              â‚¹${item.modal_price} / quintal
              <br>
              (~â‚¹${(item.modal_price / 100).toFixed(1)} per kg)
              </p>

              <p class="trend">ğŸ“ ${item.market}, ${item.state}</p>
              <p class="trend up">ğŸ“… ${item.arrival_date}</p>
            </div>
          `;
        });

        /* -----------------------------
           âœ… AI Auto Suggestion Logic
        ------------------------------ */
        let suggestionText =
          "ğŸ“Œ Best commodity today: " +
          data[0].commodity +
          " (high demand).<br>";

        suggestionText +=
          "ğŸ“‰ Vendors can buy low-priced items like " +
          data[data.length - 1].commodity +
          ".<br>";

        suggestionText +=
          "âœ… Prices are updated directly from Government mandi records.";

        document.getElementById("aiSuggestion").innerHTML = suggestionText;

      } catch (err) {
        loading.innerText = "âŒ Failed to load live mandi prices.";
        console.log("Error:", err);
      }
    }

    // Load prices when page opens
    loadLivePrices();
  </script>

</body>
</html>
